#!/bin/bash

set -ex

sudo add-apt-repository --yes ppa:juju/stable
sudo apt-get update --yes
sudo apt-get install --yes python-amulet \
                           python3-pip \
                           python-keystoneclient

# Enable http proxy if AMULET_HTTP_PROXY is set
if [[ -n "$AMULET_HTTP_PROXY" ]]; then
  export HTTP_PROXY=$AMULET_HTTP_PROXY
  export HTTPS_PROXY=$(echo $AMULET_HTTP_PROXY | sed 's/http/https/g')
  export http_proxy=$HTTP_PROXY
  export https_proxy=$HTTPS_PROXY
  env | egrep "proxy|PROXY"
fi

# Setup for generic amulet test (Not in main < Vivid, pip it instead)
sudo -E pip3 install PyMySQL
